---
layout: post
title: ! "pwnable.kr - Unexploitable"
excerpt_separator: <!--more-->
comments : true
tags:
  - Write-up
  - Wargame
  - pwnable.kr
  - pwnable
---

The challenge named "Unexploitable" which is one of Hacker's Secret and has 500 points.

<!--more-->

## Overview
The main function has few code.
```
gdb-peda$ disas main
Dump of assembler code for function main:
   0x0000000000400544 <+0>:	push   rbp
   0x0000000000400545 <+1>:	mov    rbp,rsp
   0x0000000000400548 <+4>:	sub    rsp,0x10
   0x000000000040054c <+8>:	mov    edi,0x3
   0x0000000000400551 <+13>:	mov    eax,0x0
   0x0000000000400556 <+18>:	call   0x400450 <sleep@plt>
   0x000000000040055b <+23>:	lea    rax,[rbp-0x10]
   0x000000000040055f <+27>:	mov    edx,0x50f
   0x0000000000400564 <+32>:	mov    rsi,rax
   0x0000000000400567 <+35>:	mov    edi,0x0
   0x000000000040056c <+40>:	mov    eax,0x0
   0x0000000000400571 <+45>:	call   0x400430 <read@plt>
   0x0000000000400576 <+50>:	leave  
   0x0000000000400577 <+51>:	ret    
End of assembler dump.
```
From above, we know that we can use two functions (sleep, read) and overflow the buffer. And also I found some gadgets that looks useful from [ropshell](http://ropshell.com/).
```
0x4005e6 <__libc_csu_init+102>: mov rbx,QWORD PTR [rsp+0x8]
0x4005eb <__libc_csu_init+107>: mov rbp,QWORD PTR [rsp+0x10]
0x4005f0 <__libc_csu_init+112>: mov r12,QWORD PTR [rsp+0x18]
0x4005f5 <__libc_csu_init+117>: mov r13,QWORD PTR [rsp+0x20]
0x4005fa <__libc_csu_init+122>: mov r14,QWORD PTR [rsp+0x28]
0x4005ff <__libc_csu_init+127>: mov r15,QWORD PTR [rsp+0x30]
0x400604 <__libc_csu_init+132>: add rsp,0x38
0x400608 <__libc_csu_init+136>: ret
```
csu_set
```
0x4005d0 <__libc_csu_init+80>: mov rdx,r15
0x4005d3 <__libc_csu_init+83>: mov rsi,r14
0x4005d6 <__libc_csu_init+86>: mov edi,r13d
0x4005d9 <__libc_csu_init+89>: call QWORD PTR [r12+rbx*8]
```
csu_call
## Payload Building
I need the ability that writes and reads arbitrary memory or calls arbitrary code. But all we have is just overflowable read functions in main. So, I trawled main function and found syscall gadget which can be used for calling arbitrary code.
<!--stackedit_data:
eyJoaXN0b3J5IjpbMjE4NDI4MTEwXX0=
-->